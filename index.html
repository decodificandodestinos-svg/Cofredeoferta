<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cofre de Ofertas – Canvas</title>

<style>
body {
    background:#f0f0f0;
    display:flex;
    justify-content:center;
    padding:20px;
    font-family:Segoe UI, sans-serif;
}

.container {
    background:#fff;
    padding:20px;
    border-radius:16px;
    display:flex;
    gap:20px;
    flex-wrap: wrap;
}

.controls {
    width:300px;
    display:flex;
    flex-direction:column;
}

.controls input, .controls textarea, .controls button {
    margin-bottom:10px;
    padding:10px;
    font-size:16px;
}

canvas {
    border-radius:10px;
    background:#eee;
    max-width:100%;
    height:auto;
    display:block;
}
</style>
</head>

<body>

<div class="container">

<div class="controls">
    <input type="file" id="imgInput" accept="image/*">
    <textarea id="desc" placeholder="Descrição"></textarea>
    <input id="oldPrice" placeholder="Valor antigo">
    <input id="promoPrice" placeholder="Valor promo">
    <button onclick="download()">BAIXAR</button>
</div>

<canvas id="canvas"></canvas>

</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const bg = new Image();
bg.src = "feed.png";

let productImg = null;

// Ajusta o canvas para retina / Android
function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = 1350 * ratio;
    canvas.height = 1080 * ratio;
    canvas.style.width = "450px";
    canvas.style.height = "360px";
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
    draw();
}

window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Carrega imagem do produto
imgInput.onchange = e => {
    const f = e.target.files[0];
    if (!f) return;
    productImg = new Image();
    productImg.onload = draw;
    productImg.src = URL.createObjectURL(f);
};

// Atualiza ao digitar
["desc","oldPrice","promoPrice"].forEach(id =>
    document.getElementById(id).oninput = draw
);

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Fundo
    if (bg.complete) ctx.drawImage(bg,0,0,canvas.width,canvas.height);

    // Produto
    if (productImg && productImg.complete) {
        const maxW = 900;
        const maxH = 450;
        let w = productImg.width;
        let h = productImg.height;

        // mantém proporção
        const ratio = Math.min(maxW / w, maxH / h);
        w *= ratio;
        h *= ratio;

        ctx.drawImage(productImg, (canvas.width - w)/2, 280, w, h);
    }

    // Texto descrição
    ctx.fillStyle="#333";
    ctx.font="bold 42px Segoe UI";
    ctx.textAlign="center";
    ctx.fillText(desc.value.toUpperCase(), canvas.width/2, 760);

    // Preço antigo
    ctx.fillStyle="#ff2d2d";
    ctx.font="bold 36px Segoe UI";
    ctx.fillText("R$ " + oldPrice.value, canvas.width/2, 830);

    // Caixa preço promocional
    ctx.fillStyle="#fff";
    ctx.fillRect(canvas.width/2-250, 860, 500, 120);

    ctx.fillStyle="#ff2d2d";
    ctx.font="bold 64px Segoe UI";
    ctx.fillText("R$ " + promoPrice.value, canvas.width/2, 940);
}

// Baixar imagem
function download() {
    canvas.toBlob(blob=>{
        const a=document.createElement("a");
        a.href=URL.createObjectURL(blob);
        a.download="post.png";
        a.click();
    });
}
</script>

</body>
</html>
